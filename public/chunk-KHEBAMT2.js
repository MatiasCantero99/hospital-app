import{I as b,J as u}from"./chunk-5C2VDY7O.js";import{b as n,c as s,d as r,h as i,k as p}from"./chunk-Q5NIC4DY.js";import{i as l}from"./chunk-ODN5LVDJ.js";var h=class o{supabase;isLoggedIn$=new n(!1);currentUser$=new n(null);currentUserRole$=new n(null);constructor(){this.supabase=b(u.supabaseUrl,u.supabaseKey),this.checkSession()}checkSession(){return l(this,null,function*(){let{data:{session:a}}=yield this.supabase.auth.getSession();this.isLoggedIn$.next(!!a),a?.user&&(this.currentUser$.next(a.user),this.getUserData().subscribe(e=>{let t=e?.rol??null;this.currentUserRole$.next(t)})),this.supabase.auth.onAuthStateChange((e,t)=>{console.log("Cambio de sesi\xF3n:",e,t),this.isLoggedIn$.next(!!t),this.currentUser$.next(t?.user??null)})})}logout(){return l(this,null,function*(){console.log("hola");try{yield this.supabase.auth.signOut(),localStorage.clear(),this.isLoggedIn$.next(!1)}catch(a){console.error("Error al cerrar sesi\xF3n:",a.message)}})}getUserData(){return s(this.supabase.auth.getUser()).pipe(i(({data:a})=>{let e=a?.user?.email;return e?s(this.supabase.from("admin").select("*").eq("email",e).maybeSingle()).pipe(i(t=>t.data?r(t.data):s(this.supabase.from("especialista").select("*").eq("email",e).single()).pipe(i(c=>c.data?r(c.data):s(this.supabase.from("paciente").select("*").eq("email",e).single()).pipe(i(m=>r(m.data||null))))))):r(null)}))}getSupabase(){return this.supabase}static \u0275fac=function(e){return new(e||o)};static \u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})};export{h as a};
