import{E as k,G as B,I as z,J as Z,K as _,L as H,M as K,m as D,o as U,p as s,q as L,r as $,v as q,w as G,x as M,z as j}from"./chunk-IPRHIMZZ.js";import{F as d,Ga as P,Ha as T,Ia as w,J as h,K as I,Oa as A,P as u,T as p,X as n,Y as t,Z as c,ca as E,ia as r,ua as R,va as N}from"./chunk-C32REDW4.js";import{j as b}from"./chunk-K4ALXBGI.js";function Q(o,e){o&1&&(n(0,"div",17),r(1," Ingres\xE1 un email v\xE1lido. "),t())}function V(o,e){o&1&&(n(0,"div",17),r(1," Ingres\xE1 una edad v\xE1lida. "),t())}function Y(o,e){o&1&&(n(0,"div",17),r(1," Ingres\xE1 un DNI v\xE1lido (solo n\xFAmeros). "),t())}function ee(o,e){o&1&&(n(0,"div",17),r(1," Ingres\xE1 una obra social v\xE1lida. "),t())}function te(o,e){o&1&&(n(0,"div",17),r(1," Seleccion\xE1 una imagen. "),t())}function ie(o,e){o&1&&(n(0,"div",17),r(1," Seleccion\xE1 una imagen adicional. "),t())}function ne(o,e){o&1&&c(0,"app-loading")}var v=Z(_.supabaseUrl,_.supabaseKey),O=class o{constructor(e,a,i,l){this.fb=e;this.toastr=a;this.router=i;this.loadingService=l;this.pacienteForm=this.fb.group({email:["",[s.required,s.email]],nombre:["",s.required],apellido:["",s.required],password:["",[s.required,s.minLength(6)]],edad:[null,[s.required,s.min(0)]],dni:["",[s.required,s.pattern(/^\d{7,}$/)]],obraSocial:["",s.required]})}pacienteForm;foto=null;fotoExtra=null;fotoInvalida=!1;fotoExtraInvalida=!1;captchaResuelto=!1;captchaToken=null;ngAfterViewInit(){let e=()=>{typeof grecaptcha<"u"?grecaptcha.ready(()=>{grecaptcha.render("captcha-element",{sitekey:"6LeCC2grAAAAAEm06GhsjfxCv9WPxpk9raD8NT-X",callback:a=>this.onCaptchaResolved(a)})}):setTimeout(e,500)};e()}onCaptchaResolved(e){this.captchaResuelto=!0,this.captchaToken=e}onFileChange(e,a){let i=e.target;i.files&&i.files.length>0?a==="foto"?(this.foto=i.files[0],this.fotoInvalida=!1):(this.fotoExtra=i.files[0],this.fotoExtraInvalida=!1):a==="foto"?(this.foto=null,this.fotoInvalida=!0):(this.fotoExtra=null,this.fotoExtraInvalida=!0)}register(){return b(this,null,function*(){if(!this.foto){this.toastr.error("Debes subir una foto de perfil.","Error");return}if(!this.fotoExtra){this.toastr.error("Debes subir una foto adicional.","Error");return}this.loadingService.show();let e=this.pacienteForm.value,{data:a,error:i}=yield v.auth.signUp({email:e.email,password:e.password});if(i){this.toastr.error("Error al registrar usuario","Error"),console.error("Supabase error:",i.message),this.loadingService.hide();return}if(a.user){let l=a.user.id;yield this.saveUserData(e,l)}})}saveUserData(e,a){return b(this,null,function*(){let i=e.email,l=this.foto?.name.split(".").pop(),m=this.fotoExtra?.name.split(".").pop(),f=`${i.replace(/[^a-zA-Z0-9]/g,"_")}_1.${l}`,g=`${i.replace(/[^a-zA-Z0-9]/g,"_")}_2.${m}`,S=`users/${f}`,C=`users/${g}`,{error:x}=yield v.storage.from("images").upload(S,this.foto,{upsert:!0}),{error:y}=yield v.storage.from("images").upload(C,this.fotoExtra,{upsert:!0});if(x||y){console.error("Error al subir im\xE1genes:",x?.message,y?.message),this.toastr.error("Error al subir las im\xE1genes","Error"),this.loadingService.hide();return}let{data:W}=v.storage.from("images").getPublicUrl(S),{data:X}=v.storage.from("images").getPublicUrl(C),J={nombre:e.nombre,apellido:e.apellido,edad:e.edad,dni:e.dni,email:e.email,password:e.password,rol:"paciente",obraSocial:e.obraSocial,fotoURL:W.publicUrl,fotoURL1:X.publicUrl,authid:a},{error:F}=yield v.from("paciente").insert([J]);if(F){this.toastr.error("Error al guardar paciente","Error"),console.error("Error al guardar paciente:",F.message),this.loadingService.hide();return}this.loadingService.hide(),this.toastr.success("Paciente registrado exitosamente","\xA1\xC9xito!"),this.router.navigate(["/home"])})}static \u0275fac=function(a){return new(a||o)(h(B),h(D),h(A),h(H))};static \u0275cmp=I({type:o,selectors:[["app-registro-paciente"]],decls:51,vars:11,consts:[[1,"container","mt-5"],[1,"text-center","text-primary","mb-4"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["type","email","formControlName","email",1,"form-control"],["class","text-danger",4,"ngIf"],["type","text","formControlName","nombre",1,"form-control"],["type","text","formControlName","apellido",1,"form-control"],["type","password","formControlName","password",1,"form-control"],["type","number","formControlName","edad","min","0",1,"form-control"],["type","text","formControlName","dni",1,"form-control"],["type","text","formControlName","obraSocial",1,"form-control"],["type","file",1,"form-control",3,"change"],["id","captcha-element",1,"mb-3"],["type","submit",1,"btn","btn-success","w-100",3,"disabled"],[4,"ngIf"],[1,"text-danger"]],template:function(a,i){if(a&1&&(n(0,"div",0)(1,"h3",1),r(2,"Registro de Paciente"),t(),n(3,"form",2),E("ngSubmit",function(){return i.register()}),n(4,"div",3)(5,"label",4),r(6,"Correo electr\xF3nico"),t(),c(7,"input",5),u(8,Q,2,0,"div",6),t(),n(9,"div",3)(10,"label",4),r(11,"Nombre"),t(),c(12,"input",7),t(),n(13,"div",3)(14,"label",4),r(15,"Apellido"),t(),c(16,"input",8),t(),n(17,"div",3)(18,"label",4),r(19,"Contrase\xF1a"),t(),c(20,"input",9),t(),n(21,"div",3)(22,"label",4),r(23,"Edad"),t(),c(24,"input",10),u(25,V,2,0,"div",6),t(),n(26,"div",3)(27,"label",4),r(28,"DNI"),t(),c(29,"input",11),u(30,Y,2,0,"div",6),t(),n(31,"div",3)(32,"label",4),r(33,"Obra Social"),t(),c(34,"input",12),u(35,ee,2,0,"div",6),t(),n(36,"div",3)(37,"label",4),r(38,"Foto de perfil"),t(),n(39,"input",13),E("change",function(m){return i.onFileChange(m,"foto")}),t(),u(40,te,2,0,"div",6),t(),n(41,"div",3)(42,"label",4),r(43,"Foto adicional"),t(),n(44,"input",13),E("change",function(m){return i.onFileChange(m,"fotoExtra")}),t(),u(45,ie,2,0,"div",6),t(),c(46,"div",14),n(47,"button",15),r(48," Registrarme "),t()()(),u(49,ne,1,0,"app-loading",16),R(50,"async")),a&2){let l,m,f,g;d(3),p("formGroup",i.pacienteForm),d(5),p("ngIf",((l=i.pacienteForm.get("email"))==null?null:l.invalid)&&((l=i.pacienteForm.get("email"))==null?null:l.touched)),d(17),p("ngIf",((m=i.pacienteForm.get("edad"))==null?null:m.invalid)&&((m=i.pacienteForm.get("edad"))==null?null:m.touched)),d(5),p("ngIf",((f=i.pacienteForm.get("dni"))==null?null:f.invalid)&&((f=i.pacienteForm.get("dni"))==null?null:f.touched)),d(5),p("ngIf",((g=i.pacienteForm.get("obraSocial"))==null?null:g.invalid)&&((g=i.pacienteForm.get("obraSocial"))==null?null:g.touched)),d(5),p("ngIf",i.fotoInvalida),d(5),p("ngIf",i.fotoExtraInvalida),d(2),p("disabled",i.pacienteForm.invalid),d(2),p("ngIf",N(50,9,i.loadingService.loading$))}},dependencies:[w,P,T,z,q,U,G,L,$,k,M,j,K],encapsulation:2})};export{O as a};
